<!-- seg-main-component.component.html -->
<div class="py-1 min-h-screen">
    <!-- SEG Sub-navigation (Same as Masters) -->
    <div class="sfd-sub-navigation flex bg-white rounded-xl shadow-md p-2 mb-6 relative mt-22 mx-4">
        <!-- Dashboard Button -->
        <div class="relative masters-dropdown-container text-sm">
            <button
                class="nav-item flex items-center px-4 py-2 rounded-lg transition-all duration-200 ease-in-out masters-button"
                [ngClass]="{'active bg-blue-600 text-white shadow-lg': activeSubPath === 'dashboard', 'text-gray-700 hover:bg-blue-600 -50': activeSubPath !== 'dashboard'}"
                (click)="navigateToSeg('dashboard')">
                <i class="fa-solid fa-chart-line mr-2"></i>
                <span>Dashboard</span>
            </button>
        </div>
        <!-- Transaction Button -->
        <div class="relative masters-dropdown-container text-sm">
            <button
                class="nav-item flex items-center px-4 py-2 rounded-lg transition-all duration-200 ease-in-out masters-button"
                [ngClass]="{'active bg-blue-600 text-white shadow-lg': activeSubPath === 'transaction', 'text-gray-700 hover:bg-blue-600 -50': activeSubPath !== 'transaction'}"
                (click)="navigateToSeg('transaction')">
                <i class="fa-solid fa-chart-bar mr-2"></i>
                <span>Transaction</span>
            </button>
        </div>
        <div class="relative masters-dropdown-container text-sm">
            <button
                class="nav-item flex items-center px-4 py-2 rounded-lg transition-all duration-200 ease-in-out masters-button"
                [ngClass]="{'active bg-blue-600 text-white shadow-lg': activeSubPath === 'Report', 'text-gray-700 hover:bg-blue-600 -50': activeSubPath !== 'Report'}"
                (click)="navigateToSeg('Report')">
                <i class="fa-solid fa-chart-bar mr-2"></i>
                <span>Report</span>
            </button>
        </div>
    </div>

    <!-- Main Content Area -->
    <!-- Dashboard Content -->
    <div class="max-w-screen-xl mx-auto" *ngIf="activeSubPath === 'dashboard'">
        <app-seg-dashboard></app-seg-dashboard>
    </div>

    <!-- Transaction Content -->
    <div class="max-w-screen-xl mx-auto" *ngIf="activeSubPath === 'transaction'">
        <!-- Table View -->
        <div *ngIf="showTableView && !formOnlyMode">
            <app-seg-form-table
                (editEvent)="onEditForm($event)"
                (viewEvent)="onViewForm($event)"
                (deleteEvent)="deleteReportDetails($event)"
                (tabChanged)="onTabChange($event)">
            </app-seg-form-table>
        </div>

        <!-- Form View -->
        <div *ngIf="!showTableView || formOnlyMode">
            <app-seg-form
                [formOnlyMode]="formOnlyMode"
                [mode]="isAddMode ? 'add' : 'edit'"
                [isEditMode]="!isAddMode"
                [record]="selectedReport"
                (formCancel)="toggleView()"
                (refreshData)="refreshTableData()">
            </app-seg-form>
        </div>
    </div>
    <div class="max-w-screen-xl mx-auto" *ngIf="activeSubPath === 'Report'">
        <div class="command-header">
            <div class="command-title-block">
                <i class="pi pi-file-alt"></i>
                <div>
                    <h2>SEG Reports Versions</h2>
                    <p>View and manage all SEG Reports Versions in the system</p>
                </div>
            </div>

            <div class="command-actions">
                <button class="btn primary btn-sm" (click)="navigateToSeg('transaction')">
                    <i class="pi pi-arrow-left"></i> Back
                </button>

            </div>
        </div>

        <!-- Paginated Table -->
        <app-paginated-table *ngIf="toggleTable"
            #paginatedTable
            [columns]="colReportVersions"
            [apiUrl]="'etma/version/?sub_module_id=6'"
            [totalCount]="reportVersions.length"
            [data]="reportVersions"
            [showEditAction]="false"
            [showDeleteAction]="false"
            [showEndActions]="true"
            (viewEvent)="viewReportVersion($event)"
            (dataLoaded)="onDataLoaded($event)">
        </app-paginated-table>



        <div  *ngIf="openFullPopup"  class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-70">
            <div class="w-screen h-screen bg-white flex flex-col rounded-none shadow-none overflow-hidden">
              <!-- Header -->
              <div class="flex items-center justify-between bg-blue-800 text-white px-3 py-6">
                <h3 class="text-3xl font-bold">SEG Reports Versions</h3>
                <div class="flex items-center gap-2">
                  <button  
                    printSectionId="printContainer"
                    [openNewTab]="true"
                    ngxPrint  
                    styleSheetFile="assets/print.css"
                    class="px-4 py-2 bg-red-600 text-white hover:bg-red-700 transition-colors duration-200 flex items-center gap-2 rounded"
                    >
                    <i class="pi pi-file-pdf"></i>
                    PDF
                  </button>
                  <button  
                    (click)="downloadWord()"
                    [disabled]="isDocLoading"
                    class="px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 transition-colors duration-200 flex items-center gap-2 rounded disabled:opacity-50"
                    >
                    <i class="pi pi-file" *ngIf="!isDocLoading"></i>
                    <i class="pi pi-spin pi-spinner" *ngIf="isDocLoading"></i>
                    {{ isDocLoading ? 'Generating...' : 'Word' }}
                  </button>
                  <button 
                    (click)="closeReportVersionPopup()" 
                    class="p-2 rounded-full hover:bg-blue-600 transition-colors"  
                    aria-label="Close"
                  > 
                    <i class="pi pi-times"></i>
                  </button>
                </div>
              </div>
              <!-- Content/Table -->
               <div class="flex-1 overflow-auto p-6">
                  <div id="printContainer" class="report-version-container"></div>
               </div>
              
            </div>
          </div>

        <!-- Loading Overlay for Word Download -->
        <div class="loading-overlay" *ngIf="isDocLoading">
          <div class="loading-content">
            <button class="close-btn" (click)="cancelLoading()" title="Cancel Loading">
              <i class="pi pi-times"></i>
            </button>
            
            <div class="spinner-border text-primary" role="status">
              <span class="sr-only">Loading...</span>
            </div>
            
            <div class="mt-4 text-center">
              <h3 class="text-blue-700 font-semibold">Generating document...</h3>
              <p class="text-gray-600 mt-2">Please wait while we process your request.</p>
            </div>

            <div class="progress-container mt-4">
              <div class="progress">
                <div class="progress-bar" 
                     role="progressbar" 
                     [style.width.%]="docProgress"
                     [attr.aria-valuenow]="docProgress"
                     aria-valuemin="0" 
                     aria-valuemax="100">
                  {{ docProgress | number:'1.0-0' }}%
                </div>
              </div>
              <div class="progress-text mt-2">
                <span *ngIf="isDocLoading && docProgress < 30">Initializing document generation...</span>
                <span *ngIf="isDocLoading && docProgress >= 30 && docProgress < 60">Processing document content...</span>
                <span *ngIf="isDocLoading && docProgress >= 60 && docProgress < 90">Finalizing document...</span>
                <span *ngIf="isDocLoading && docProgress >= 90">Preparing download...</span>
              </div>
            </div>
          </div>
        </div>
        
    </div>
</div>

<!-- Delete Confirmation Modal -->
<app-delete-confirmation-modal
    [visible]="showDeleteDialog"
    [message]="'Are you sure you want to delete this SEG Form Report?'"
    (onConfirm)="confirmDeletion()"
    (onCancel)="cancelDeletion()">
</app-delete-confirmation-modal>

<app-toast></app-toast>

