<div class=" bg-white rounded-lg shadow-md mt-3">
  <ng-container *ngIf="isLoading">
    <app-loading-spinner></app-loading-spinner>
  </ng-container>
  <div class="">
      <p-table #dt1 [columns]="columns" [value]="data" 
      [rowHover]="true"
      [rows]="rowsPerPage"
      [showCurrentPageReport]="showCurrentPageReport"
      [rowsPerPageOptions]="rowsPerPageOptions"
      [paginator]="true"
      
      [totalRecords]="totalCount"
      [currentPageReportTemplate]="'Showing {first} to {last} of {totalRecords} entries'"
      [scrollable]="true" 
      showGridlines="horizontal"
      styleClass="p-datatable-gridlines p-datatable-striped rounded-lg overflow-hidden"
      resizableColumns="true" 
      columnResizeMode="expand" 
      (onPage)="onPageChange($event)"
      dataKey="id"
    >

      <ng-template pTemplate="caption">
        <div class="flex items-center justify-between p-4 bg-white/80 backdrop-blur-sm border-b border-gray-200">
          <button
            class="px-4 py-2 bg-white text-green-600 rounded-lg hover:bg-green-50 transition-all duration-200 flex items-center gap-2 text-sm border border-green-200"
            (click)="clear(dt1)">
            <i class="pi pi-filter-slash text-sm"></i>
            <span>Clear Filters</span>
          </button>

          <div class="relative w-80">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="pi pi-search text-gray-400 text-sm"></i>
            </div>
            <input type="text"
              class="w-full pl-10 pr-10 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-200 bg-white text-sm placeholder-gray-400"
              [(ngModel)]="searchValue" (input)="dt1.filterGlobal(onSearchInput(searchValue), 'contains')"
              placeholder="Search..." />
            <div *ngIf="searchValue" class="absolute inset-y-0 right-0 pr-3 flex items-center">
              <button (click)="searchValue = ''; dt1.filterGlobal('', 'contains')"
                class="p-1 text-gray-400 hover:text-red-500 rounded transition-all duration-200">
                <i class="pi pi-times text-sm"></i>
              </button>
            </div>
          </div>
        </div>
      </ng-template>
      <ng-template pTemplate="header">
        <tr>
          <th *ngIf="selectionEnabled" class="custom_header_class sticky-header">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>

          <th class="custom_header_class sticky-header" *ngFor="let col of columns" pResizableColumn>
            <div class="flex items-center gap-2">
              <p-sortIcon [field]="col.field" [pSortableColumn]="col.field"></p-sortIcon>
              {{ col.header }}
              <p-columnFilter [type]="col.filterType || 'text'" [field]="col.field" display="menu" />
            </div>
          </th>

          <ng-container *ngFor="let extraCol of extraHeaderColumns">
            <th class="custom_header_class sticky-header">
              {{ extraCol.header }}
            </th>
          </ng-container>

          <th class="custom_header_class sticky-header text-right" *ngIf="showEndActions">
            Actions
          </th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
        <tr (click)="rowClicked(rowData)">
          <td *ngIf="selectionEnabled">
            <p-tableCheckbox [value]="rowData"></p-tableCheckbox>
          </td>

          <td *ngFor="let col of columns" [ngClass]="{'address-cell': col.field === 'address'}">
            <ng-container *ngIf="col.header === 'Active'; else normalCell">
              <span class="px-2 py-1 text-xs font-medium rounded-full {{ rowData[col.field] == 1 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' }}">
                {{ rowData[col.field] == 1 ? 'Active' : 'Inactive' }}
              </span>
            </ng-container>
            <ng-template #normalCell>
              {{ rowData | nestedValue: col.field }}
            </ng-template>
          </td>

          <ng-container *ngFor="let extraCol of extraColumns; let i = index">
            <td *ngIf="extraHeaderColumns[i]?.innerHTML; else plainText">
              <span [innerHTML]="extraCol(rowData)"></span>
            </td>
            <ng-template #plainText>
              <td>{{ extraCol(rowData) }}</td>
            </ng-template>
          </ng-container>

          <td class="text-right" *ngIf="showEndActions" style="position: relative">
            <p-menu #actionMenu [model]="getActionItems(rowData)" [popup]="true" appendTo="body" />
            <p-button label="Actions" class="p-button-rounded p-button-outlined p-button-sm" (click)="actionMenu.toggle($event)" aria-label="Actions"></p-button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td [attr.colspan]="columns.length + 1" class="px-4 py-16 text-center">
            <div class="flex flex-col items-center justify-center gap-4">
              <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center">
                <i class="pi pi-inbox text-gray-400 text-2xl"></i>
              </div>
              <div class="space-y-2">
                <h5 class="text-lg font-semibold text-gray-700">No Records Found</h5>
                <p class="text-gray-500 text-sm">Your table is empty. Start by adding some data.</p>
              </div>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
    <!-- <div class="flex flex-col items-center justify-center py-16 px-4 text-center" *ngIf="data?.length === 0">
    <ng-container *ngIf="emptyStateTemplate; else defaultEmptyState">
      <ng-container *ngTemplateOutlet="emptyStateTemplate"></ng-container>
    </ng-container>
    <ng-template #defaultEmptyState>
      <div class="mb-4">
        <ng-container *ngIf="dropdown; else noRecords">
          <div class="animate-bounce">
            <i class="text-4xl text-gray-400 mb-2" [ngClass]="filterIcon"></i>
          </div>
          <h3 class="text-lg font-semibold text-gray-700 mb-2">{{ filterTitle }}</h3>
          <p class="text-gray-500">{{ filterMessage }}</p>
        </ng-container>
        <ng-template #noRecords>
          <div class="animate-pulse">
            <i class="text-4xl text-gray-400 mb-2" [ngClass]="emptyIcon"></i>
          </div>
          <h3 class="text-lg font-semibold text-gray-700 mb-2">{{ emptyTitle }}</h3>
          <p class="text-gray-500">{{ emptyMessage }}</p>
        </ng-template>
      </div>
    </ng-template>
  </div> -->