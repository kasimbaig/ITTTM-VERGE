<div class="">
  <div class="command-header">
    <div class="command-title-block">
      <i class="fa-solid fa-chart-pie"></i>
      <div>
        <h2>Defect Overview</h2>
        <p>Comprehensive defect analysis and reporting dashboard</p>
      </div>
    </div>
    <!-- <div class="command-actions">
      <p-dropdown [options]="organizationalFilterOptions" [(ngModel)]="selectedOrganizationalFilter"
        (onChange)="onOrganizationalFilterChange($event)" placeholder="Select Organization" optionLabel="label" [filter]="true" [filterBy]="'label'"
        optionValue="value" styleClass="filter-dropdown" [appendTo]="'body'"></p-dropdown>

      <p-dropdown [options]="commandOptions" [(ngModel)]="selectedCommand" (onChange)="onCommandChange($event)"
        placeholder="Select Command" optionLabel="label" optionValue="value" [showClear]="false" [filter]="true" [filterBy]="'label'"
        styleClass="filter-dropdown" [appendTo]="'body'"></p-dropdown>

      <p-dropdown [options]="shipOptions" [(ngModel)]="selectedShip" (onChange)="onShipChange($event)"
        placeholder="Select Ship" optionLabel="label" optionValue="value" [showClear]="false" [filter]="true" [filterBy]="'label'"
        styleClass="filter-dropdown" [appendTo]="'body'"></p-dropdown>
    </div> -->
  </div>

  <div class="kpi-cards-grid w-full max-w-full my-4">
    <app-dashboard-card *ngFor="let metric of kpiMetrics" [title]="metric.title" [value]="metric.value"
      [description]="metric.description" [iconClass]="metric.iconClass" [type]="metric.type" [color]="metric.color"
      (cardClick)="drillDown($event, metric.type)"></app-dashboard-card>
  </div>

  <!-- SRAR KPI Cards Section -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6 mb-8 w-full max-w-full">
    <!-- Total Ships Card -->
    <div class="group relative bg-white/80 backdrop-blur-sm rounded-2xl shadow-md hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 ease-in-out overflow-hidden border border-gray-200/50 hover:border-blue-300/50">
      <div class="relative p-8 h-full flex flex-col items-center justify-center gap-4">
        <div class="flex items-center gap-4">
          <div class="p-3 rounded-xl bg-linear-to-br from-blue-50 to-indigo-100 group-hover:from-blue-100 group-hover:to-indigo-200 transition-all duration-300 shadow-sm">
            <svg class="w-8 h-8 text-blue-600 transition-transform duration-300 group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
            </svg>
          </div>
          <h2 class="text-4xl font-bold text-gray-900 transition-all duration-300 group-hover:scale-105">{{ getTotalShips() }}</h2>
        </div>
        <p class="text-sm font-semibold text-gray-600 text-center group-hover:text-gray-800 transition-colors duration-300">Total Ships</p>
      </div>
      <div class="absolute bottom-0 left-0 right-0 h-1 bg-linear-to-r from-blue-500 via-purple-500 to-pink-500 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500 origin-left"></div>
    </div>

    <!-- Total RH at Sea Card -->
    <div class="group relative bg-white/80 backdrop-blur-sm rounded-2xl shadow-md hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 ease-in-out overflow-hidden border border-gray-200/50 hover:border-cyan-300/50">
      <div class="relative p-8 h-full flex flex-col items-center justify-center gap-4">
        <div class="flex items-center gap-4">
          <div class="p-3 rounded-xl bg-linear-to-br from-cyan-50 to-cyan-100 group-hover:from-cyan-100 group-hover:to-cyan-200 transition-all duration-300 shadow-sm">
            <svg class="w-8 h-8 text-cyan-600 transition-transform duration-300 group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
          </div>
          <h2 class="text-4xl font-bold text-gray-900 transition-all duration-300 group-hover:scale-105">{{ getTotalRHAtSea() }}</h2>
        </div>
        <p class="text-sm font-semibold text-gray-600 text-center group-hover:text-gray-800 transition-colors duration-300">Total RH at Sea</p>
      </div>
      <div class="absolute bottom-0 left-0 right-0 h-1 bg-linear-to-r from-blue-500 via-purple-500 to-pink-500 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500 origin-left"></div>
    </div>

    <!-- Avg RH at Sea Card -->
    <div class="group relative bg-white/80 backdrop-blur-sm rounded-2xl shadow-md hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 ease-in-out overflow-hidden border border-gray-200/50 hover:border-teal-300/50">
      <div class="relative p-8 h-full flex flex-col items-center justify-center gap-4">
        <div class="flex items-center gap-4">
          <div class="p-3 rounded-xl bg-linear-to-br from-teal-50 to-teal-100 group-hover:from-teal-100 group-hover:to-teal-200 transition-all duration-300 shadow-sm">
            <svg class="w-8 h-8 text-teal-600 transition-transform duration-300 group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
          </div>
          <h2 class="text-4xl font-bold text-gray-900 transition-all duration-300 group-hover:scale-105">{{ getAvgRHAtSea() }}</h2>
        </div>
        <p class="text-sm font-semibold text-gray-600 text-center group-hover:text-gray-800 transition-colors duration-300">Avg RH at Sea</p>
      </div>
      <div class="absolute bottom-0 left-0 right-0 h-1 bg-linear-to-r from-blue-500 via-purple-500 to-pink-500 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500 origin-left"></div>
    </div>

    <!-- Max RH Card -->
    <div class="group relative bg-white/80 backdrop-blur-sm rounded-2xl shadow-md hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 ease-in-out overflow-hidden border border-gray-200/50 hover:border-orange-300/50">
      <div class="relative p-8 h-full flex flex-col items-center justify-center gap-4">
        <div class="flex items-center gap-4">
          <div class="p-3 rounded-xl bg-linear-to-br from-orange-50 to-orange-100 group-hover:from-orange-100 group-hover:to-orange-200 transition-all duration-300 shadow-sm">
            <svg class="w-8 h-8 text-orange-600 transition-transform duration-300 group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
          </div>
          <h2 class="text-4xl font-bold text-gray-900 transition-all duration-300 group-hover:scale-105">{{ getMaxRunningHours() }}</h2>
        </div>
        <p class="text-sm font-semibold text-gray-600 text-center group-hover:text-gray-800 transition-colors duration-300">Max RH</p>
      </div>
      <div class="absolute bottom-0 left-0 right-0 h-1 bg-linear-to-r from-blue-500 via-purple-500 to-pink-500 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500 origin-left"></div>
    </div>

    <!-- Operational Ships Card -->
    <div class="group relative bg-white/80 backdrop-blur-sm rounded-2xl shadow-md hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 ease-in-out overflow-hidden border border-gray-200/50 hover:border-purple-300/50">
      <div class="relative p-8 h-full flex flex-col items-center justify-center gap-4">
        <div class="flex items-center gap-4">
          <div class="p-3 rounded-xl bg-linear-to-br from-purple-50 to-purple-100 group-hover:from-purple-100 group-hover:to-purple-200 transition-all duration-300 shadow-sm">
            <svg class="w-8 h-8 text-purple-600 transition-transform duration-300 group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
          </div>
          <h2 class="text-4xl font-bold text-gray-900 transition-all duration-300 group-hover:scale-105">{{ getOperationalCount() }}</h2>
        </div>
        <p class="text-sm font-semibold text-gray-600 text-center group-hover:text-gray-800 transition-colors duration-300">Operational Ships</p>
      </div>
      <div class="absolute bottom-0 left-0 right-0 h-1 bg-linear-to-r from-blue-500 via-purple-500 to-pink-500 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500 origin-left"></div>
    </div>
  </div>

  <app-drt-chart></app-drt-chart>
  

</div>

<p-dialog [(visible)]="displayDrilldownDialog" [header]="drilldownDialogTitle" [modal]="true"
  [style]="{ width: '70vw', maxWidth: '900px' }" [baseZIndex]="10000" (onHide)="onHideDrilldownDialog()">
  <ng-template pTemplate="content">
    <p-table [value]="drilldownTableData" [columns]="drilldownTableCols" [paginator]="true" [rows]="10"
      [rowHover]="true" styleClass="p-datatable-sm p-datatable-gridlines">
      <ng-template pTemplate="header" let-columns>
        <tr>
          <th *ngFor="let col of columns" [pSortableColumn]="col.field">
            {{ col.header }}
            <p-sortIcon *ngIf="col.field" [field]="col.field"></p-sortIcon>
          </th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-rowData let-columns="columns">
        <tr>
          <td *ngFor="let col of columns">
            {{ rowData[col.field] }}
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptyMessage">
        <tr>
          <td [attr.colspan]="drilldownTableCols.length" class="text-center">No records found.</td>
        </tr>
      </ng-template>
    </p-table>
  </ng-template>
  <ng-template pTemplate="footer">
    <p-button label="Close" icon="pi pi-times" (click)="onHideDrilldownDialog()"
      styleClass="p-button-secondary"></p-button>
  </ng-template>
</p-dialog>