<div class="">
  <div class="command-header">
    <div class="command-title-block">
      <i class="fa-solid fa-chart-pie"></i>
      <div>
        <h2>Defect Overview</h2>
        <p>Comprehensive defect analysis and reporting dashboard</p>
      </div>
    </div>
    <div class="command-actions">
      <p-dropdown [options]="organizationalFilterOptions" [(ngModel)]="selectedOrganizationalFilter"
        (onChange)="onOrganizationalFilterChange($event)" placeholder="Select Organization" optionLabel="label" [filter]="true" [filterBy]="'label'"
        optionValue="value" styleClass="filter-dropdown" [appendTo]="'body'"></p-dropdown>

      <p-dropdown [options]="commandOptions" [(ngModel)]="selectedCommand" (onChange)="onCommandChange($event)"
        placeholder="Select Command" optionLabel="label" optionValue="value" [showClear]="false" [filter]="true" [filterBy]="'label'"
        styleClass="filter-dropdown" [appendTo]="'body'"></p-dropdown>

      <p-dropdown [options]="shipOptions" [(ngModel)]="selectedShip" (onChange)="onShipChange($event)"
        placeholder="Select Ship" optionLabel="label" optionValue="value" [showClear]="false" [filter]="true" [filterBy]="'label'"
        styleClass="filter-dropdown" [appendTo]="'body'"></p-dropdown>
    </div>
  </div>

  <div class="kpi-cards-grid w-full max-w-full my-4">
    <app-dashboard-card *ngFor="let metric of kpiMetrics" [title]="metric.title" [value]="metric.value"
      [description]="metric.description" [iconClass]="metric.iconClass" [type]="metric.type" [color]="metric.color"
      (cardClick)="drillDown($event, metric.type)"></app-dashboard-card>
  </div>

  <!-- SRAR KPI Cards Section -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8 w-full">
    <!-- Total Ships Card -->
    <div class="bg-white rounded p-4 shadow border">
      <p class="text-gray-600 text-sm mb-2">Total Ships</p>
      <p class="text-gray-900 text-3xl font-bold">{{ getTotalShips() }}</p>
    </div>

    <!-- Total RH at Sea Card -->
    <div class="bg-white rounded p-4 shadow border">
      <p class="text-gray-600 text-sm mb-2">Total RH at Sea</p>
      <p class="text-gray-900 text-3xl font-bold">{{ getTotalRHAtSea() }}</p>
    </div>

    <!-- Avg RH at Sea Card -->
    <div class="bg-white rounded p-4 shadow border">
      <p class="text-gray-600 text-sm mb-2">Avg RH at Sea</p>
      <p class="text-gray-900 text-3xl font-bold">{{ getAvgRHAtSea() }}</p>
    </div>

    <!-- Max RH Card -->
    <div class="bg-white rounded p-4 shadow border">
      <p class="text-gray-600 text-sm mb-2">Max RH</p>
      <p class="text-gray-900 text-3xl font-bold">{{ getMaxRunningHours() }}</p>
    </div>

    <!-- Operational Ships Card -->
    <div class="bg-white rounded p-4 shadow border">
      <p class="text-gray-600 text-sm mb-2">Operational</p>
      <p class="text-gray-900 text-3xl font-bold">{{ getOperationalCount() }}</p>
    </div>
  </div>

  <app-drt-chart></app-drt-chart>
  

</div>

<p-dialog [(visible)]="displayDrilldownDialog" [header]="drilldownDialogTitle" [modal]="true"
  [style]="{ width: '70vw', maxWidth: '900px' }" [baseZIndex]="10000" (onHide)="onHideDrilldownDialog()">
  <ng-template pTemplate="content">
    <p-table [value]="drilldownTableData" [columns]="drilldownTableCols" [paginator]="true" [rows]="10"
      [rowHover]="true" styleClass="p-datatable-sm p-datatable-gridlines">
      <ng-template pTemplate="header" let-columns>
        <tr>
          <th *ngFor="let col of columns" [pSortableColumn]="col.field">
            {{ col.header }}
            <p-sortIcon *ngIf="col.field" [field]="col.field"></p-sortIcon>
          </th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-rowData let-columns="columns">
        <tr>
          <td *ngFor="let col of columns">
            {{ rowData[col.field] }}
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptyMessage">
        <tr>
          <td [attr.colspan]="drilldownTableCols.length" class="text-center">No records found.</td>
        </tr>
      </ng-template>
    </p-table>
  </ng-template>
  <ng-template pTemplate="footer">
    <p-button label="Close" icon="pi pi-times" (click)="onHideDrilldownDialog()"
      styleClass="p-button-secondary"></p-button>
  </ng-template>
</p-dialog>